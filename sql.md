## 第一章 了解SQL
### 1.1 数据库基础
1.1.1 数据库（database：保存有组织的数据的容器）
数据库管理系统（DBMS）
数据库是通过DBMS创建和操纵的容器；

1.1.2 表（table：某种特定类型数据的结构化清单）

1.1.3 列和数据类型
列 (column)：表中的一个字段。所有表都是由一个或多个列组成的。
数据类型：所允许的数据的类型。每个表列都有相应的数据类型，它限制(或允许)该列中存储的数据。

1.1.4 行（row) ：表中的一个记录。

1.1.5 主键(primary key) ：一列(或一组列)，其值能够唯一标识表中每一行。
表中的任何列都可以作为主键，只要它满足以下条件:
· 任意两行都不具有相同的主键值;
· 每一行都必须具有一个主键值(主键列不允许NULL值);
· 主键列中的值不允许修改或更新;
· 主键值不能重用(如果某行从表中删除，它的主键不能赋给以后的新行)。


### 1.2 什么是SQL
SQL(发音为字母S-Q-L或sequel)是结构化查询语言(Structured Query Language)的缩写。SQL是一种专门用来与数据库沟通的语言。
SQL有如下的优点。
· SQL不是某个特定数据库供应商专有的语言。几乎所有重要的DBMS都支持SQL，所以学习此语言使你几乎能与所有数据库打交道。
· SQL简单易学。它的语句全都是由有很强描述性的英语单词组成，而且这些单词的数目不多。
· SQL虽然看上去很简单，但实际上是一种强有力的语言，灵活使用其语言元素，可以进行非常复杂和高级的数据库操作。



## 第2章 检索数据(select)
### 2.1 SELECT语句

### 2.2 检索单个列
SQL语句不区分大小写，因此SELECT与select是相同的。同样，写成Select也没有关系。许多SQL开发人员喜欢对SQL关键字使用 大写，而对列名和表名使用小写，这样做使代码更易于阅读和调试。
SELECT prod_name FROM Products;

2.3 检索多个列
在选择多个列时，一定要在列名之间加上逗号，但最后一个列名后不加。如果在最后一个列名后加了逗号，将出现错误。
SELECT prod_id, prod_name, prod_price FROM Products;

### 2.4 检索所有列
使用通配符*
一般而言，除非你确实需要表中的每一列，否则最好别使用*通配符。虽然使用通配符能让你自己省事，不用明确列出所需列，但检索不需 要的列通常会降低检索和应用程序的性能。
使用通配符有一个大优点。由于不明确指定列名(因为星号检索每一列)，所以能检索出名字**未知的列**。
SELECT * FROM Products;                  可能重复

### 2.5 检索不同的值
SELECT DISTINCT vend_id FROM Products;
使用 DISTINCT 关键字去重，它必须直接放在列名的前面，且不能部分使用DISTINCT。

### 2.6 限制结果
SELECT prod_name FROM Products LIMIT 5;
只检索前5行数据。
SELECT prod_name FROM Products LIMIT 5 OFFSET 5;  返回从第5行起的5行数据。第一个数字是指从哪儿开始，第二个数字是检索的行数。

### 2.7 使用注释
行内注释:使用-- (两个连字符)嵌在行内。-- 之后的文本就是注释。
SELECT prod_name -- 这是一条注释
FROM Products;

行内注释：
    # 这是一条注释
    SELECT prod_name
    FROM Products;

多行注释：
注释从/\*开始，到\*/结束，/\*和\*/之间的任何内容都是注释


## 第3章 排序检索数据（order by）
### 3.1 排序数据
在指定一条ORDER BY子句时，应该保证它是SELECT语句中最后一条子句。如果它不是最后的子句，将会出现错误消息。
SELECT prod_name FROM Products ORDER BY prod_name;

### 3.2 按多个列排序
按多个列排序，简单指定列名，列名之间用逗号分开即可；
SELECT prod_id, prod_price, prod_name FROM Products
ORDER BY prod_price, prod_name;

### 3.3 按列位置排序
order by 关键字(ASC 升序排列)

### 3.4 指定排序方向
使用ORDER BY子句进行降序(从Z到A)排序。为了进行降序排序，必须使用DESC关键字。
如果想在多个列上进行降序排序，必须对每一列指定DESC关键字。


## 第4章 过滤数据
### 4.1 使用WHERE子句
数据库表一般包含大量的数据，很少需要检索表中的所有行。通常只会根据特定操作或报告的需要提取表数据的子集。只检索所需数据需要指
定搜索条件(search criteria)，搜索条件也称为过滤条件(filter condition)。

在SELECT语句中，数据根据WHERE子句中指定的搜索条件进行过滤。WHERE子句在表名(FROM子句)之后给出。

在同时使用ORDER BY和WHERE子句时，应该让ORDER BY位于WHERE之后，否则将会产生错误。

### 4.2 WHERE子句操作符
=    等于
<>   不等于
!=   不等于
<    小于
<=   小于等于
!<   不小于
>    大于
>=   大于等于
!>   不大于
BETWEEN   在指定的两个值之间, between 5 and 10
IS NULL   为NULL值

如果将值与字符串类型 的列进行比较，就需要限定引号。用来与数值列进行比较的值不用引号。


第5章 高级数据过滤
### 5.1 组合WHERE子句
要通过不止一个列进行过滤，可以使用AND操作符给WHERE子句附加条件。

OR操作符与AND操作符正好相反，它指示DBMS检索匹配任一条件的行。

IN操作符用来指定条件范围，范围中的每个条件都可以进行匹配。IN取一组由逗号分隔、括在圆括号中的合法值。



## 第6课 用通配符进行过滤
### 6.1 LIKE操作符
通 配 符 ( wildcard) 用来匹配值的一部分的特殊字符。

搜索模式(search pattern) 由字面值、通配符或两者组合构成的搜索条件。

通配符本身实际上是SQL的WHERE子句中有特殊含义的字符，SQL支持几种通配符。为在搜索子句中使用通配符，必须使用LIKE操作符。LIKE指 示DBMS，后跟的搜索模式利用通配符匹配而不是简单的相等匹配进行比较。


6.1.1 百分号(%)通配符
在搜索串中，%表示任何字符出现任意次数。


6.1.2 下划线(_)通配符
下划线的用途与%一样，但它只匹配单个字符，而不是多个字符。


6.1.3 方括号([ ])通配符
方括号([])通配符用来指定一个字符集，它必须匹配指定位置(通配符的位置)的一个字符。


6.2 使用通配符的技巧
· 不要过度使用通配符。如果其他操作符能达到相同的目的，应该使用其他操作符。
· 在确实需要使用通配符时，也尽量不要把它们用在搜索模式的开始处。
· 把通配符置于开始处，搜索起来是最慢的。 仔细注意通配符的位置。如果放错地方，可能不会返回想要的数据。



##第7课 创建计算字段
### 7.1 计算字段
字 段 ( field) 基本上与列(column)的意思相同，经常互换使用，不过数据库列一般称为列，而术语字段通常与计算字段一起使用。


### 7.2 拼接字段
拼 接 ( concatenate) 将值联结到一起(将一个值附加到另一个值)构成单个值。

在SQL中的SELECT语句中，可使用一个特殊的操作符来拼接两个列。根据你所使用的DBMS，此操作符可用加 号(+)或两个竖杠(||)表示。

TRIM函数 大多数DBMS都支持RTRIM()(去掉字符串右边的空格)、LTRIM()(去掉字符串左边的空格)以及TRIM()(去掉字符串左 右两边的空格)。

SQL支持列别名。别名(alias)是一个字段或值的替换名。别名用AS关键字赋予。


### 7.3 执行算术计算



## 第8课 使用数据处理函数
### 8.1 函数

### 8.2 使用函数
大多数SQL实现支持以下类型的函数。
· 用于处理文本字符串(如删除或填充值，转换值为大写或小写)的文本函数。
· 用于在数值数据上进行算术操作(如返回绝对值，进行代数运算)的数值函数。
· 用于处理日期和时间值并从这些值中提取特定成分(如返回两个日期之差，检查日期有效性)的日期和时间函数。
·返回DBMS正使用的特殊信息(如返回用户登录信息)的系统函数。

8.2.1 文本处理函数
UPPER()将文本转换为大写



## 第9课 汇总数据
### 9.1 聚集函数
9.1.1 AVG()函数对表中行数计数并计算其列值之和，求得该列的平均值。


9.1.2 COUNT()函数
COUNT()函数进行计数。可利用COUNT()确定表中行的数目或符合特定条件的行的数目。
· COUNT()函数有两种使用方式:
· 使用COUNT(*)对表中行的数目进行计数，不管表列中包含的是空值(NULL)还是非空值。 使用COUNT(column)对特定列中具有值的行进行计数，忽略NULL值。


9.1.3 MAX()函数
MAX()返回指定列中的最大值。MAX()要求指定列名。

9.1.4 MIN()函数
MIN()的功能正好与MAX()功能相反，它返回指定列的最小值。与MAX()一样，MIN()要求指定列名。

9.1.5 SUM()函数
SUM()用来返回指定列值的和(总计)。



## 第10课 分组数据
### 10.1 数据分组

### 10.2 创建分组
在使用GROUP BY子句前，需要知道一些重要的规定。
· GROUP BY子句可以包含任意数目的列，因而可以对分组进行嵌套，更细致地进行数据分组。
· 如果在GROUP BY子句中嵌套了分组，数据将在最后指定的分组上进行汇总。换句话说，在建立分组时，指定的所有列都一起计算(所以不 能从个别的列取回数据)。
· GROUP BY子句中列出的每一列都必须是检索列或有效的表达式(但不能是聚集函数)。如果在SELECT中使用表达式，则必须在GROUP BY子 句中指定相同的表达式。不能使用别名。
· 大多数SQL实现不允许GROUP BY列带有长度可变的数据类型(如文本或备注型字段)。
· 除聚集计算语句外，SELECT语句中的每一列都必须在GROUP BY子句中给出。
· 如果分组列中包含具有NULL值的行，则NULL将作为一个分组返回。如果列中有多行NULL值，它们将分为一组。
· GROUP BY子句必须出现在WHERE子句之后，ORDER BY子句之前。


### 10.3 过滤分组
HAVING非常类似于WHERE。事实上，目前为止所学过的所有类 型的WHERE子句都可以用HAVING来替代。唯一的差别是，WHERE过滤行，而HAVING过滤分组。


### 10.4 分组和排序
ORDER BY
对产生的输出排序
任意列都可以使用(甚至非选择的列也可以使用)
不一定需要

GROUP BY
对行分组，但输出可能不是分组的顺序
只可能使用选择列或表达式列，而且必须使用每个选择列表达式
如果与聚集函数一起使用列(或表达式)，则必须使用


### 10.5 SELECT子句顺序
| 子句 | 说明 | 是否必须使用 |
|------|------|--------------|
|SELECT| 要返回的列或表达式| 是|
|FROM |从中检索数据的表|仅在从表选择数据时使用|
|WHERE |行级过滤| 否|
|GROUP BY|分组说明|仅在;按计算聚集时使用|
|HAVING|组级过滤|否|
|ORDER BY|输出排序顺序|否|



## 第11课 使用子查询
### 11.1 子查询
查询(query) 任何SQL语句都是查询。但此术语一般指SELECT语句。




## 第12课 联结表
### 12.1 联结
SQL最强大的功能之一就是能在数据查询的执行中联结(join)表。联结是利用SQL的SELECT能执行的最重要的操作。

### 12.2 创建联结
在联结两个表时，实际要做的是将第一 个表中的每一行与第二个表中的每一行配对。WHERE子句作为过滤条件，只包含那些匹配给定条件(这里是联结条件)的行。没有WHERE子句， 第一个表中的每一行将与第二个表中的每一行配对，而不管它们逻辑上是否能配在一起。

笛卡儿积(cartesian product) 由没有联结条件的表关系返回的结果为笛卡儿积。检索出的行的数目将是第一个表中的行数乘以第二个表中的行数。


目前为止使用的联结称为等值联结(equijoin)，它基于两个表之间的相等测试。这种联结也称为内联结(inner join)。



## 第13课 创建高级联结
使用不同类型的联结,三种其他联结:自联结(self-join)、自然联结(natural join)和外联结
(outer join)。

使用带聚集函数的联结



## 第14课 组合查询
UNION非常容易使用，但在进行组合时需要注意几条规则。
· UNION必须由两条或两条以上的SELECT语句组成，语句之间用关键字UNION分隔(因此，如果组合四条SELECT语句，将要使用三个UNION关 键字)。
· UNION中的每个查询必须包含相同的列、表达式或聚集函数(不过，各个列不需要以相同的次序列出)。
· 列数据类型必须兼容:类型不必完全相同，但必须是DBMS可以隐含转换的类型(例如，不同的数值类型或不同的日期类型)。



## 第15课 插入数据
### 15.1 数据插入
INSERT用来将行插入(或添加)到数据库表。插入有几种方式:
·   插入完整的行;
·   插入行的一部分;
·   插入某些查询的结果。

INTO关键字 在某些SQL实现中，跟在INSERT之后的INTO关键字是可选的。但是，即使不一定需要，最好还是提供这个关键字，这样做将保证SQL代码在 DBMS之间可移植。


### 15.2 从一个表复制到另一个表
要将一个表的内容复制到一个全新的表(运行中创建的表)，可以使用SELECT INTO语句。

INSERT SELECT与SELECT INTO 它们之间的一个重要差别是前者导出数据，而后者导入数据。

SELECT INTO是试验新SQL语句前进行表复制的很好工具。先进行复制，可在复制的数据上测试SQL代码，而不会影响实际的数据。



## 第16课 更新和删除数据
### 16.1 更新数据
更新(修改)表中的数据，可以使用UPDATE语句。有两种使用UPDATE的方式:
   更新表中的特定行;
   更新表中的所有行。

基本的UPDATE语句由三部分组成，分别是:
   要更新的表;
   列名和它们的新值;
   确定要更新哪些行的过滤条件。


### 16.2 删除数据
从一个表中删除(去掉)数据，使用DELETE语句。有两种使用DELETE的方式:
   从表中删除特定的行;
   从表中删除所有行。


### 16.3 更新和删除的指导原则
使用UPDATE或DELETE时所遵循的重要原则。
· 除非确实打算更新和删除每一行，否则绝对不要使用不带WHERE子句的UPDATE或DELETE语句。
· 保证每个表都有主键(如果忘记这个内容，请参阅第12课)，尽可能像WHERE子句那样使用它(可以指定各主键、多个值或值的范围)。
· 在UPDATE或DELETE语句使用WHERE子句前，应该先用SELECT进行测试，保证它过滤的是正确的记录，以防编写的WHERE子句不正确。
· 使用强制实施引用完整性的数据库(关于这个内容，请参阅第12课)，这样DBMS将不允许删除其数据与其他表相关联的行。
· 有的DBMS允许数据库管理员施加约束，防止执行不带WHERE子句的UPDATE或DELETE语句。如果所采用的DBMS支持这个特性，应该使用 它。





## 第17课 创建和操纵表
### 17.1 创建表
利用CREATE TABLE创建表，必须给出下列信息:
新表的名字，在关键字CREATE TABLE之后给出; 表列的名字和定义，用逗号分隔; 有的DBMS还要求指定表的位置。


### 17.2 更新表
更新表定义，可以使用ALTER TABLE语句。虽然所有的DBMS都支持ALTER TABLE，但它们所允许更新的内容差别很大。以下是使用ALTER TABLE 时需要考虑的事情：
· 理想情况下，不要在表中包含数据时对其进行更新。应该在表的设计过程中充分考虑未来可能的需求，避免今后对表的结构做大改动。
· 所有的DBMS都允许给现有的表增加列，不过对所增加列的数据类型(以及NULL和DEFAULT的使用)有所限制。
· 许多DBMS不允许删除或更改表中的列。
· 多数DBMS允许重新命名表中的列。
· 许多DBMS限制对已经填有数据的列进行更改，对未填有数据的列几乎没有限制。


### 17.3 删除表
删除表(删除整个表而不是其内容)非常简单，使用DROP TABLE语句即可。
删除表没有确认，也不能撤销，执行这条语句将永久删除该表。


### 17.4 重命名表
DB2、MariaDB、MySQL、Oracle和PostgreSQL用户使
用RENAME语句，SQL Server用户使用sp_rename存储过程，SQLite用户使用ALTER TABLE语句。



## 第18课 使用视图
### 18.1 视图
视图是虚拟的表。与包含数据的表不一样，视图只包含使用时动态检索数据的查询。

18.1.1 为什么使用视图
18.1.2 视图的规则和限制

### 18.2 创建视图
18.2.1 利用视图简化复杂的联结
18.2.2 用视图重新格式化检索出的数据
18.2.3 用视图过滤不想要的数据
18.2.4 使用视图与计算字段


## 第19课 使用存储过程
19.1 存储过程
19.2 为什么要使用存储过程
19.3 执行存储过程
19.3 执行存储过程
19.4 创建存储过程
19.5 小结



## 第20课 管理事务处理
20.1 事务处理
事务(transaction)指一组SQL语句;
回退(rollback)指撤销指定SQL语句的过程;
提交(commit)指将未存储的SQL语句结果写入数据库表;
保留点(savepoint)指事务处理中设置的临时占位符(placeholder)，可以对它发布回退(与回退整个事务处理不同)。


20.2 控制事务处理
BEGIN TRANSACTION ...
COMMIT TRANSACTION

20.2.1 使用ROLLBACK
DELETE FROM Orders;
ROLLBACK;

20.2.2 使用COMMIT
BEGIN TRANSACTION
DELETE OrderItems WHERE order_num = 12345
DELETE Orders WHERE order_num = 12345
COMMIT TRANSACTION

20.2.3 使用保留点




## 第21课 使用游标
21.1 游标
游标(cursor)是一个存储在DBMS服务器上的数据库查询，
它不是一条SELECT语句，而是被该语句检索出来的结果集。在存储了游标之后，应用程序可以根据需要滚动或浏览其中的数据。

游标与基于Web的应用 游标对基于Web的应用(如ASP、ASP.NET、ColdFusion、PHP、Python、Ruby、JSP等)用处不大。虽然游标在客户端应用和服务器会 话期间存在，但这种客户/服务器模式不适合Web应用，因为应用服务器是数据库客户端而不是最终用户。所以，大多数Web应用开发人员 不使用游标，他们根据自己的需要重新开发相应的功能。


21.2 使用游标
21.2.1 创建游标
21.2.2 使用游标
21.2.3 关闭游标



## 第22课 高级SQL特性
### 22.1 约束
约 束 ( constraint) 管理如何插入或处理数据库数据的规则。

表中任意列只要满足以下条件，都可以用于主键:
· 任意两行的主键值都不相同。
· 每行都具有一个主键值(即列中不允许NULL值)。
· 包含主键值的列从不修改或更新。(大多数DBMS不允许这么做，但如果你使用的DBMS允许这样做，好吧，千万别!)
· 主键值不能重用。如果从表中删除某一行，其主键值不分配给新行。

22.1.1 主键
22.1.2 外键
22.1.3 唯一约束
唯一约束用来保证一列(或一组列)中的数据是唯一的。它们类似于主键，但存在以下重要区别。
· 表可包含多个唯一约束，但每个表只允许一个主键。
· 唯一约束列可包含NULL值。
· 唯一约束列可修改或更新。
· 唯一约束列的值可重复使用。
· 与主键不一样，唯一约束不能用来定义外键。

22.1.4 检查约束
检查约束用来保证一列(或一组列)中的数据满足一组指定的条件。检查约束的常见用途有以下几点。
· 检查最小或最大值。例如，防止0个物品的订单(即使0是合法的数)。
· 指定范围。例如，保证发货日期大于等于今天的日期，但不超过今天起一年后的日期。
· 只允许特定的值。例如，在性别字段中只允许M或F。


22.2 索引
在开始创建索引前，应该记住以下内容:
· 索引改善检索操作的性能，但降低了数据插入、修改和删除的性能。在执行这些操作时，DBMS必须动态地更新索引。
· 索引数据可能要占用大量的存储空间。 并非所有数据都适合做索引。取值不多的数据(如州)不如具有更多可能值的数据(如姓或名)，能通过索引得到那么多的好处。
· 索引用于数据过滤和数据排序。如果你经常以某种特定的顺序排序数据，则该数据可能适合做索引。
· 可以在索引中定义多个列(例如，州加上城市)。这样的索引仅在以州加城市的顺序排序时有用。如果想按城市排序，则这种索引没有用处。



22.3 触发器
触发器是特殊的存储过程，它在特定的数据库活动发生时自动执行。触发器可以与特定表上的INSERT、UPDATE和DELETE操作(或组合)相关联。

触发器内的代码具有以下数据的访问权:
· INSERT操作中的所有新数据;
· UPDATE操作中的所有新数据和旧数据;
· DELETE操作中删除的数据。

触发器的一些常见用途。
· 保证数据一致。例如，在INSERT或UPDATE操作中将所有州名转换为大写。
· 基于某个表的变动在其他表上执行活动。例如，每当更新或删除一行时将审计跟踪记录写入某个日志表。
· 进行额外的验证并根据需要回退数据。例如，保证某个顾客的可用资金不超限定，如果已经超出，则阻塞插入。
· 计算计算列的值或更新时间戳。


22.4 数据库安全
需要保护的操作有:
   对数据库管理功能(创建表、更改或删除已存在的表等)的访问;
   对特定数据库或表的访问;
   访问的类型(只读、对特定列的访问等);
   仅通过视图或存储过程对表进行访问;
   创建多层次的安全措施，从而允许多种基于登录的访问和控制;
   限制管理用户账号的能力。

·
